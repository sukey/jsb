#!/usr/bin/env python
#
#

""" convert gozerbot pickled data to jsonbot. """

## boot

import os, sys
sys.path.insert(0, os.getcwd())

## jsb imports

from jsb.utils.generic import sedfile
from jsb.utils.exception import handle_exception
from jsb.lib.persist import Persist
from jsb.lib.config import Config

## basic imports

import os
import pickle

## convert function

def convert(source, target):
    for file in os.listdir(source):
        try:
            f = sedfile(source + os.sep + file, "s/cgozerbot/cjsb.lib/")
            obj = pickle.loads(f.getvalue())
            f.close()
            p = Persist(target + os.sep + file)
            p.data = obj
            p.save()
        except Exception, ex:
            if "Is a dir" in str(ex): continue
            print "ERROR: %s - %s" % (source + os.sep + file, str(ex))
            handle_exception()
            for l in open(source + os.sep + file, 'r'):
                print l
try:
    convert(sys.argv[1], sys.argv[2])
except IndexError: print "jsb-gozerimport <gozerdata dir> <output dir>"