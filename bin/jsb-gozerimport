#!/usr/bin/env python
#
#

""" convert gozerbot pickled data to jsonbot. """

## boot

import os, sys
sys.path.insert(0, os.getcwd())

## jsb imports

from jsb.utils.exception import handle_exception
from jsb.lib.persist import Persist
from jsb.lib.config import Config

## basic imports

import os
import pickle

## convert function

def convert(source, target):
    for file in os.listdir(source):
        try:
            f = open(source + os.sep + file, "r")
            obj = pickle.load(f)
            if file.endswith("-config"):
                d = {}
                for key, option in obj.iteritems():
                    d[key] = option.value
                print d
                c = Config(file, ddir=target, input=d)
                c.tofile(target + os.sep + file)
            else:
                p = Persist(target + os.sep + file)
                p.data = obj
                p.save()
        except Exception, ex: print "ERROR: %s - %s" % (source + os.sep + file, str(ex))

try:
    convert(sys.argv[1], sys.argv[2])
except IndexError: print "jsb-gozerimport <gozerdata dir> <output dir>"